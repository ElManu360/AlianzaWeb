<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Alianza Lima | Club del Pueblo</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        :root {
            --alianza-azul: #B8A26A;
            --alianza-dorado: #B8A26A;
            --alianza-blanco: #ffffff;
            --fondo-partidos: #2c2c2c; /* Color oscuro para la secci√≥n de partidos */
            --texto-claro: #f0f0f0;
            --linea-separadora: #555555;
        }

        body {
            padding-top: 56px;
            background-color: #f8f9fa;
        }
        .navbar-brand { font-weight: bold; }

        /* JUMBOTRON Y IMAGEN DE FONDO */
        .jumbotron {
            background-color: var(--alianza-azul);
            color: var(--alianza-blanco);
            padding: 5rem 2rem;
            margin-bottom: 0;
            border-radius: 0;
            /* RUTA DE IMAGEN - DEBES ASEGURARTE QUE ESTE CORRECTA */
            background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('/img/menuprincipal/baner.jpg'); 
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        /* BOT√ìN "HAZTE √çNTIMO" (DORADO/BEIGE Y TEXTO BLANCO) */
        .btn-intimo {
            background-color: var(--alianza-dorado);
            color: var(--alianza-blanco);
            border-color: var(--alianza-dorado);
            font-weight: bold;
            padding: 10px 30px;
            font-size: 1.25rem;
            transition: background-color 0.3s;
        }
        .btn-intimo:hover {
            background-color: #9A845C;
            color: var(--alianza-blanco);
            border-color: #9A845C;
        }
        .bg-primary { background-color: var(--alianza-azul) !important; }

        /* ESTILOS PARA LA SECCI√ìN DE PARTIDOS */
        .seccion-partidos {
            background-color: var(--fondo-partidos);
            color: var(--texto-claro);
            padding: 3rem 0;
        }
        .partido-header {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .partido-detalle {
            border-bottom: 1px solid var(--linea-separadora);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
        }
        .equipo-nombre {
            font-weight: bold;
            margin-top: 0.5rem;
        }
        .vs-texto {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .partido-info-footer {
            font-size: 0.9rem;
            color: #aaaaaa;
            margin-top: 1rem;
        }
		.escudo-partido {
		    width: 90px;  /* Ajusta el tama√±o seg√∫n tu preferencia */
		    height: 90px; /* Asegura que la imagen sea cuadrada */
		    object-fit: contain; /* Para que la imagen no se recorte ni se estire */
		    margin-bottom: 10px;
		}
		/* ESTILOS PARA LA SECCI√ìN DE NOTICIAS */
		.seccion-noticias {
		    /* Aqu√≠ definimos el fondo de la secci√≥n principal de noticias */
		    background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
		                      url('/img/menuprincipal/fondon.jpg'); /* <-- RUTA DE LA IMAGEN DE FONDO */
		    background-size: cover;
		    background-position: center;
		    background-repeat: no-repeat;
		    
		    padding: 3rem 0;
		    color: var(--alianza-blanco); /* El texto ser√° blanco para contrastar con el fondo oscuro */
		}

		/* Modificar el t√≠tulo para que destaque en el fondo oscuro */
		.titulo-noticias {
		    font-size: 2rem;
		    font-weight: 600;
		    color: var(--alianza-blanco); /* ¬°Cambiado a blanco! */
		    text-align: center;
		    margin-bottom: 2rem;
		    padding-bottom: 10px;
		    border-bottom: 2px solid var(--alianza-dorado);
		    display: inline-block;
		    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.9);
		}

		/* Ajustes para las tarjetas (cards) para que se vean bien sobre el fondo oscuro */
		.card-noticia {
		    background-color: rgba(255, 255, 255, 0.9); /* Tarjeta semi-transparente o muy clara */
		    transition: transform 0.3s ease;
		    border: 1px solid #ddd;
		    border-radius: 0.5rem;
		    text-decoration: none;
		    color: inherit;
		    display: block;
		}

		.card-title-link {
		    /* Mantenemos oscuro el texto principal para que se vea bien dentro de la tarjeta */
		    color: #343a40; 
		}
		.card-title-link:hover {
		    color: var(--alianza-azul);
		    text-decoration: none;
		}
		/* ESTILOS PARA EL FOOTER */
		.footer-banner-img {
		    /* Reemplaza la imagen directamente en el CSS como fondo */
		    background-image: url('/img/menuprincipal/patrocinadores.jpg');
		    background-size: cover; /* Asegura que la imagen cubra todo el espacio */
		    background-position: center; /* Centra la imagen */
		    background-repeat: no-repeat;
		    height: 120px; /* Define una altura visible para el banner */
		    width: 100%;
		    margin-bottom: 0;
		}
		/* ESTILOS PARA EL BANNER DE ENTRADAS */
		.banner-entradas {
		    background-color: var(--alianza-azul); /* Color de fallback */
		    background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), 
		                      url('/img/menuprincipal/entradas.png'); /* <-- RUTA DE LA IMAGEN PROMOCIONAL */
		    background-size: cover;
		    background-position: center;
		    background-repeat: no-repeat;
		    padding: 5rem 0; /* Espacio vertical grande */
		    text-align: center;
		    color: var(--alianza-blanco);
		    margin-bottom: 0; /* Para pegarse a la secci√≥n de noticias si es necesario */
		}
		/* Estilo para el bot√≥n de Entradas (similar al "Hazte √çntimo") */
		.btn-entradas {
		    background-color: var(--alianza-dorado);
		    color: white; /* Texto azul oscuro */
		    border-color: var(--alianza-dorado);
		    font-weight: bold;
		    padding: 12px 40px;
		    font-size: 1.5rem;
		    margin-top: 1.5rem;
		    transition: background-color 0.3s;
		}

		.btn-entradas:hover {
		    background-color: #9A845C; /* Tono de hover del dorado */
		    color: var(--alianza-blanco); /* Cambiamos el texto a blanco en hover */
		    border-color: #9A845C;
		}
    </style>
</head>
<body>

	<nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
	    <a class="navbar-brand" th:href="@{/Admin/principal}">Alianza Admin</a>
	    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
	        <span class="navbar-toggler-icon"></span>
	    </button>
	    <div class="collapse navbar-collapse" id="navbarNav">
	        
	        <ul class="navbar-nav mr-auto">
	            <li class="nav-item">
	                <a class="nav-link" th:href="@{/Admin/principal}">Principal</a>
	            </li>
	            
	            <li class="nav-item">
	                <a class="nav-link" th:href="@{/Admin/ventas}">Reporte de Ventas</a> 
	            </li>
	            
	            <li class="nav-item">
	                <a class="nav-link" th:href="@{/Admin/entradas}">Gesti√≥n de Entradas</a>
	            </li>

	            <li class="nav-item">
	                <a class="nav-link" th:href="@{/Admin/usuarios}">Gesti√≥n de Usuarios y Roles</a>
	            </li>
	            
	        </ul>
	        
	        <ul class="navbar-nav">
	            <li class="nav-item text-light d-flex align-items-center mr-3">
	                Bienvenido, <strong class="ml-1" th:text="${nombreUsuarioLogeado}">Admin</strong>
	            </li>
	            <li class="nav-item">
	                <a class="nav-link btn btn-outline-light" th:href="@{/General/logout}" style="border-radius: 0.25rem;">Cerrar Sesi√≥n</a> 
	            </li>
	        </ul>
	    </div>
	</nav>
	
	<!-- Tabla usuarios -->
	<div class="container-fluid py-4">
	    <div class="row justify-content-center">
	        <div class="col-12">
	            <div class="card shadow-sm">
	                <div class="card-body p-4">
	                    <h1 class="h4 mb-4 text-center">Gesti√≥n de Usuarios</h1>
	                    
	                    <div class="table-responsive">
	                        <table class="table table-striped table-hover">
	                            <thead class="table-light">
	                                <tr>
	                                    <th scope="col" class="px-3">Id</th>
	                                    <th scope="col" class="px-3">Nombres</th>
	                                    <th scope="col" class="px-3">Contrase√±a</th>
	                                    <th scope="col" class="px-3">Email</th>
	                                    <th scope="col" class="px-3">Rol</th>
	                                    <th scope="col" class="px-3">Estado</th>
	                                    <th scope="col" class="px-3 text-center">Acciones</th>
	                                </tr>
	                            </thead>
	                            <tbody>
	                                <tr th:each="usua : ${listaUsuarios}">
	                                    <td class="px-3" th:text="${usua.id_usuario}">1</td>
	                                    <td class="px-3" th:text="${usua.nombreUsuario}">Nombres</td>
	                                    <td class="px-3">
	                                        <div class="password-field">
	                                            <span class="password-text" th:text="${usua.password}">Contrase√±a</span>
	                                        </div>
	                                    </td>
	                                    <td class="px-3" th:text="${usua.email}">Email</td>
	                                    
	                                    <!-- Select para rol con √≠conos -->
										<td class="px-3">
										    <select class="form-select form-select-sm rol-select custom-select"
										            th:data-id="${usua.id_usuario}"
										            th:disabled="${usua.id_usuario == usuarioActual.id_usuario}">
										        <option value="Admin" th:selected="${usua.rol == 'Admin'}">üëë Admin</option>
										        <option value="Usuario" th:selected="${usua.rol == 'Usuario'}">üë§ Usuario</option>
										        <option value="Proveedor" th:selected="${usua.rol == 'Proveedor'}">üè¢ Proveedor</option>
										    </select>
										</td>
	                                    
	                                    <!-- Select para estado con colores -->
										<td class="px-3">
										    <select class="form-select form-select-sm estado-select custom-select"
										            th:data-id="${usua.id_usuario}"
										            th:disabled="${usua.id_usuario == usuarioActual.id_usuario}">
										        <option value="true" th:selected="${usua.estado}" class="text-success">üü¢ Activo</option>
										        <option value="false" th:selected="${!usua.estado}" class="text-secondary">üî¥ Inactivo</option>
										    </select>
										</td>
	                                    
										<td class="px-3">
										    <div class="d-flex justify-content-center">
										        <button type="button" class="btn btn-success btn-sm btn-guardar me-2"
										                th:data-id="${usua.id_usuario}"
										                th:disabled="${usua.id_usuario == usuarioActual.id_usuario}"
										                title="Guardar cambios">
										            <i class="bi bi-check-circle"></i> Guardar
										        </button>
										    </div>
										</td>
	                                </tr>
	                            </tbody>
	                        </table>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
	
	<!-- Estilos para la tabla usuarios -->
	<style>
	.password-field {
	    max-width: 150px;
	    overflow: hidden;
	    text-overflow: ellipsis;
	    white-space: nowrap;
	}

	.password-text {
	    font-family: 'Courier New', monospace;
	    font-size: 0.9em;
	    color: #6c757d;
	}

	.table th, .table td {
	    vertical-align: middle;
	}

	/* Estilos personalizados para los selects */
	.custom-select {
	    border: 2px solid #e9ecef;
	    border-radius: 8px;
	    transition: all 0.3s ease;
	    font-weight: 500;
	}

	.custom-select:focus {
	    border-color: #0d6efd;
	    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.1);
	}

	.rol-select {
	    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
	}

	.estado-select {
	    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
	}

	/* Colores espec√≠ficos para estados */
	.estado-select option[value="true"] {
	    color: #198754;
	    font-weight: 600;
	}

	.estado-select option[value="false"] {
	    color: #6c757d;
	    font-weight: 600;
	}

	/* Colores para roles */
	.rol-select option[value="Admin"] {
	    color: #dc3545;
	    font-weight: 600;
	}

	.rol-select option[value="Usuario"] {
	    color: #0d6efd;
	    font-weight: 600;
	}

	.rol-select option[value="Proveedor"] {
	    color: #fd7e14;
	    font-weight: 600;
	}

	.btn-guardar, .btn-eliminar {
	    transition: all 0.2s ease-in-out;
	}

	.btn-guardar:hover, .btn-eliminar:hover {
	    transform: translateY(-1px);
	}
	</style>
	
	<!-- AJAX para actualizar sin recargar -->
	<script>
	document.addEventListener('DOMContentLoaded', function() {
	    document.querySelectorAll('.btn-guardar').forEach(btn => {
	        btn.addEventListener('click', function() {
	            const id = this.getAttribute('data-id');
	            const rol = document.querySelector(`.rol-select[data-id='${id}']`).value;
	            const estado = document.querySelector(`.estado-select[data-id='${id}']`).value;

	            fetch('/Admin/actualizarRolEstado', {
	                method: 'POST',
	                headers: {
	                    'Content-Type': 'application/json'
	                },
	                body: JSON.stringify({ id_usuario: id, rol: rol, estado: estado })
	            })
	            .then(response => {
	                if (!response.ok) throw new Error('Error al actualizar');
	                return response.text();
	            })
	            .then(msg => {
	                alert('‚úÖ ' + msg);
	            })
	            .catch(err => {
	                alert('‚ùå Error: ' + err.message);
	            });
	        });
	    });
	});
	</script>

		
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

</body>
</html>